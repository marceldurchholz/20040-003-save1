var openFB=function(){function e(e,o,n){a=e,o&&(u=o),n&&(l=n)}function o(e,o,t){if(!a)return t({error:"Facebook App Id not set."});var r;if(e=e||"",d=o,f=t,!u)if(c())u="https://www.facebook.com/connect/login_success.html";else{var s=document.location.href.indexOf("index.html");if(!(s>0))return alert("Can't reliably guess the OAuth redirect URI. Please specify it explicitly in openFB.init()");u=window.document.location.href.substring(0,s)+"oauthcallback.html"}r=window.open(p+"?client_id="+a+"&redirect_uri="+u+"&response_type=token&display=popup&scope="+e,"_blank","location=no"),c()&&(r.addEventListener("loadstart",function(e){var o=e.url;o.indexOf("access_token=")>0&&(r.close(),n(o))}),r.addEventListener("exit",function(e){var o=e.url;o.indexOf("access_token=")>0&&deferredLogin.reject()}))}function n(e){var o=decodeURIComponent(e.substr(e.indexOf("#")+1)),n=o.split("&"),t={};n.forEach(function(e){var o=e.split("=");t[o[0]]=o[1]});var r=t.access_token;r?(l.fbtoken=r,d&&d()):f&&f()}function t(){l.fbtoken=void 0}function r(e){var o,n=e.method||"GET",t=e.params||{},r=new XMLHttpRequest;t.access_token=l.fbtoken,o="https://graph.facebook.com"+e.path+"?"+i(t),r.onreadystatechange=function(){if(console.log(r.readyState+" "+r.status),4===r.readyState)if(200===r.status)e.success&&e.success(JSON.parse(r.responseText));else{var o=r.responseText?JSON.parse(r.responseText).error:{message:"An error has occurred"};e.error&&e.error(o)}},r.open(n,o,!0),r.send()}function s(e,o){return r({method:"DELETE",path:"/me/permissions",success:function(){l.fbtoken=void 0,e()},error:o})}function i(e){var o=[];for(var n in e)e.hasOwnProperty(n)&&o.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return o.join("&")}function c(){return window.device&&window.device.cordova}var a,u,d,f,p="https://www.facebook.com/dialog/oauth",l=window.sessionStorage;return{init:e,login:o,logout:t,revokePermissions:s,api:r,oauthCallback:n}}();